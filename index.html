    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Hệ thống dự đoán sản lượng và giống phù hợp</title>
        <style>
    /* Biến gốc cho chủ đề và tái sử dụng */
    :root {
        --border-radius: 1.2rem; /* Bán kính bo góc */
        --transition-duration: 0.3s; /* Thời gian chuyển đổi */
        --max-container-width: 1280px; /* Chiều rộng tối đa của container */
        --font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; /* Phông chữ */
        --shadow-color: rgba(0, 0, 0, 0.12); /* Màu bóng */
        --glass-bg: rgba(255, 255, 255, 0.15); /* Nền kính mờ */
        --glass-blur: blur(12px); /* Độ mờ kính */
        --temperature-color: #e63946; /* Màu nhiệt độ */
        --humidity-color: #1d84c6; /* Màu độ ẩm */
        --precipitation-color: #0984e3; /* Màu lượng mưa */
        --precipitation-probability-color: #00a8cc; /* Màu khả năng mưa */
        --sunshine-color: #f4a261; /* Màu nắng */
        --menu-width: 250px; /* Chiều rộng menu */
        --menu-trigger-width: 20px; /* Chiều rộng nút kích hoạt menu */
    }

    /* Chủ đề sáng (mặc định) */
    :root {
        --primary-gradient-start: #a8e6cf; /* Màu bắt đầu gradient chính */
        --primary-gradient-end: #dcedc8; /* Màu kết thúc gradient chính */
        --box-gradient-start: #a8e6cf; /* Màu bắt đầu gradient box */
        --box-gradient-end: #dcedc8; /* Màu kết thúc gradient box */
        --calendar-gradient-start: #81d4fa; /* Màu bắt đầu gradient lịch */
        --calendar-gradient-end: #e0f7fa; /* Màu kết thúc gradient lịch */
        --text-dark: #1a2632; /* Màu chữ tối */
        --text-light: #f5f6f5; /* Màu chữ sáng */
        --box-bg: rgba(255, 255, 255, 0.85); /* Nền box */
        --calendar-bg: #fff; /* Nền lịch */
        --calendar-border: #e74c3c; /* Viền lịch */
        --calendar-shadow: rgba(0, 0, 0, 0.15); /* Bóng lịch */
        --menu-bg: rgba(255, 255, 255, 0.9); /* Nền menu */
        --menu-hover-bg: rgba(230, 230, 230, 0.8); /* Nền menu khi hover */
        --menu-text: #1a2632; /* Màu chữ menu */
    }

    /* Hỗ trợ chủ đề tối */
    @media (prefers-color-scheme: dark) {
        :root {
            --primary-gradient-start: #2d6a4f; /* Màu bắt đầu gradient chính (tối) */
            --primary-gradient-end: #4a7043; /* Màu kết thúc gradient chính (tối) */
            --box-gradient-start: #2d6a4f; /* Màu bắt đầu gradient box (tối) */
            --box-gradient-end: #4a7043; /* Màu kết thúc gradient box (tối) */
            --calendar-gradient-start: #3498db; /* Màu bắt đầu gradient lịch (tối) */
            --calendar-gradient-end: #34495e; /* Màu kết thúc gradient lịch (tối) */
            --text-dark: #e6ecef; /* Màu chữ tối (tối) */
            --text-light: #2c3e50; /* Màu chữ sáng (tối) */
            --box-bg: rgba(40, 54, 70, 0.9); /* Nền box (tối) */
            --glass-bg: rgba(40, 54, 70, 0.25); /* Nền kính mờ (tối) */
            --calendar-bg: #34495e; /* Nền lịch (tối) */
            --calendar-border: #c0392b; /* Viền lịch (tối) */
            --calendar-shadow: rgba(0, 0, 0, 0.4); /* Bóng lịch (tối) */
            --menu-bg: rgba(40, 54, 70, 0.9); /* Nền menu (tối) */
            --menu-hover-bg: rgba(60, 80, 100, 0.8); /* Nền menu khi hover (tối) */
            --menu-text: #e6ecef; /* Màu chữ menu (tối) */
        }
    }

    /* Reset và kiểu cơ bản */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    body {
        font-family: var(--font-family); /* Phông chữ mặc định */
        min-height: 100vh; /* Chiều cao tối thiểu toàn màn hình */
        background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end)); /* Nền gradient */
        padding: clamp(1.5rem, 5vw, 2.5rem); /* Khoảng cách lề */
        overflow-x: hidden; /* Ngăn cuộn ngang */
        position: relative;
    }

    /* Kiểu cho menu thanh bên */
    .menu-container {
        position: fixed;
        top: 0;
        left: calc(-1 * var(--menu-width)); /* Ẩn menu bên trái */
        width: var(--menu-width); /* Chiều rộng menu */
        height: 100%;
        background: var(--menu-bg); /* Nền menu */
        backdrop-filter: var(--glass-blur); /* Hiệu ứng kính mờ */
        border-right: 2px solid rgba(255, 255, 255, 0.4); /* Viền phải */
        box-shadow: 0 8px 20px var(--shadow-color); /* Bóng menu */
        transition: transform var(--transition-duration) ease; /* Hiệu ứng chuyển đổi */
        z-index: 1000;
    }

    .menu-container:hover,
    .menu-trigger:hover ~ .menu-container {
        transform: translateX(var(--menu-width)); /* Hiển thị menu khi hover */
    }

    .menu-trigger {
        position: fixed;
        top: 0;
        left: 0;
        width: var(--menu-trigger-width); /* Chiều rộng nút kích hoạt */
        height: 100%;
        background: rgba(0, 0, 0, 0.1); /* Nền nút kích hoạt */
        cursor: pointer;
        z-index: 1100;
    }

    .menu {
        padding: 2rem 1rem; /* Khoảng cách trong menu */
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Khoảng cách giữa các mục menu */
    }

    .menu-item {
        padding: 1rem;
        color: var(--menu-text); /* Màu chữ menu */
        font-size: clamp(1rem, 2vw, 1.2rem); /* Kích thước chữ */
        font-weight: 500;
        border-radius: 0.6rem; /* Bo góc */
        transition: background var(--transition-duration) ease; /* Hiệu ứng hover */
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem; /* Khoảng cách giữa biểu tượng và chữ */
    }

    .menu-item:hover {
        background: var(--menu-hover-bg); /* Nền khi hover */
    }

    .menu-item i {
        font-size: 1.2rem; /* Kích thước biểu tượng */
    }

    /* Container chính để chia bố cục giữa các box và lịch */
    .body-container {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem; /* Khoảng cách giữa các phần */
        max-width: var(--max-container-width); /* Chiều rộng tối đa */
        margin: 0 auto;
        align-items: flex-start;
        margin-left: calc(var(--menu-trigger-width) + 1rem); /* Khoảng cách lề trái */
    }

    /* Phần bên phải (Lịch + Dự báo thời tiết) */
    .right-side {
        display: flex;
        flex-direction: column;
        gap: 2rem; /* Khoảng cách giữa lịch và dự báo */
        width: 450px; /* Tăng chiều rộng để chứa nội dung */
        max-width: 100%;
    }

    /* Kiểu cho tiêu đề */
    .title {
        color: red; /* Màu chữ tiêu đề */
        font-size: clamp(2rem, 6vw, 3.2rem); /* Kích thước chữ */
        font-weight: 700;
        text-align: center;
        margin: 2.5rem 0;
        padding: 1.5rem 3rem;
        background: linear-gradient(135deg, var(--glass-bg), rgba(255, 255, 255, 0.3)); /* Nền kính mờ */
        backdrop-filter: var(--glass-blur); /* Hiệu ứng kính mờ */
        border-radius: var(--border-radius); /* Bo góc */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); /* Bóng */
        border: 2px solid rgba(255, 255, 255, 0.4); /* Viền */
        animation: fadeInDown 0.8s ease-out, glow 2s ease-in-out infinite alternate; /* Hiệu ứng */
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.25); /* Bóng chữ */
        letter-spacing: 1px;
    }

    /* Hiệu ứng phát sáng */
    @keyframes glow {
        from {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 20px rgba(255, 255, 255, 0.2);
        }
        to {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3), 0 0 30px rgba(255, 255, 255, 0.4);
        }
    }

    .box-container {
        flex: 1;
        min-width: 0;
        display: flex;
        flex-direction: column;
        gap: 2rem; /* Khoảng cách giữa các hàng */
        background-image: url("img/nendata.jpg"); /* Hình nền */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        padding: 1rem;
        border-radius: var(--border-radius); /* Bo góc */
        box-shadow: 0 8px 20px var(--shadow-color); /* Bóng */
    }

    /* Hàng trên: 2 box */
    .top-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2 cột */
        gap: 2rem;
    }

    /* Hàng dưới: 3 box */
    .bottom-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3 cột */
        gap: 2rem;
    }

    /* Kiểu cho các box */
    .box {
        background: var(--box-bg); /* Nền box */
        padding: 2rem;
        border-radius: var(--border-radius); /* Bo góc */
        box-shadow: 0 8px 25px var(--shadow-color); /* Bóng */
        text-align: center;
        transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease; /* Hiệu ứng hover */
        animation: fadeInUp 0.6s ease-out forwards; /* Hiệu ứng xuất hiện */
        animation-delay: calc(var(--delay) * 0.15s);
        will-change: transform, box-shadow;
        min-width: 0;
    }

    .box:nth-child(1) { --delay: 1; }
    .box:nth-child(2) { --delay: 2; }
    .box:nth-child(3) { --delay: 3; }
    .box:nth-child(4) { --delay: 4; }
    .box:nth-child(5) { --delay: 5; }

    .box:hover {
        transform: translateY(-0.6rem); /* Di chuyển lên khi hover */
        box-shadow: 0 14px 35px var(--shadow-color); /* Bóng lớn hơn khi hover */
    }

    /* Kiểu chữ cho box */
    .box h1 {
        color: var(--text-dark); /* Màu chữ tiêu đề */
        font-size: clamp(1.3rem, 3vw, 1.6rem); /* Kích thước chữ */
        font-weight: 500;
        margin-bottom: 1.2rem;
        letter-spacing: 0.6px;
    }

    .data {
        font-size: clamp(1rem, 2.5vw, 1.3rem); /* Kích thước chữ dữ liệu */
        color: #7f8c8d; /* Màu chữ */
        font-weight: 400;
    }

    .value {
        font-size: clamp(2rem, 4.5vw, 2.8rem); /* Kích thước chữ giá trị */
        font-weight: 700;
        display: block;
        margin: 0.6rem 0;
        transition: color var(--transition-duration) ease; /* Hiệu ứng chuyển màu */
    }

    #temperature { color: var(--temperature-color); }
    #humidity { color: var(--humidity-color); }
    #soil_moisture { color: #2ca02c; }
    #nh3 { color: #7209b7; }
    #precipitation { color: var(--precipitation-color); }

    /* Container lịch với nền */
    .calendar-container {
        background: linear-gradient(135deg, var(--calendar-gradient-start), var(--calendar-gradient-end)); /* Nền gradient lịch */
        border-radius: var(--border-radius); /* Bo góc */
        box-shadow: 0 8px 20px var(--calendar-shadow); /* Bóng */
        padding: 1.5rem;
        border-top: 8px solid var(--calendar-border); /* Viền trên */
        animation: fadeInRight 0.8s ease-out; /* Hiệu ứng xuất hiện */
    }

    /* Hiệu ứng xé giấy */
    .calendar-container::before {
        content: '';
        position: absolute;
        top: -8px;
        left: 0;
        right: 0;
        height: 8px;
        background: repeating-linear-gradient(
            45deg,
            transparent,
            transparent 10px,
            rgba(0, 0, 0, 0.1) 10px,
            rgba(0, 0, 0, 0.1) 20px
        );
    }

    /* Kiểu lịch */
    .calendar {
        text-align: center;
    }

    .calendar-month-year {
        font-size: clamp(1.1rem, 2vw, 1.3rem); /* Kích thước chữ tháng-năm */
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
    }

    .calendar-day {
        font-size: clamp(2.5rem, 5vw, 3.5rem); /* Kích thước chữ ngày */
        font-weight: 700;
        color: var(--calendar-border);
        margin: 0.5rem 0;
        line-height: 1;
    }

    .calendar-weekday {
        font-size: clamp(1rem, 1.8vw, 1.2rem); /* Kích thước chữ thứ */
        font-weight: 500;
        color: #7f8c8d;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
    }

    .calendar-time {
        font-size: clamp(1rem, 1.8vw, 1.2rem); /* Kích thước chữ thời gian */
        font-weight: 400;
        color: var(--text-dark);
    }

    /* Container dự báo thời tiết bên dưới lịch */
    .weather-container {
        background: linear-gradient(135deg, var(--calendar-gradient-start), var(--calendar-gradient-end)); /* Nền gradient */
        border-radius: var(--border-radius); /* Bo góc */
        box-shadow: 0 8px 20px var(--calendar-shadow); /* Bóng */
        padding: 1.5rem;
        animation: fadeInRight 0.8s ease-out; /* Hiệu ứng xuất hiện */
        width: 100%;
    }

    /* Danh sách dự báo thời tiết */
    .weather-forecast {
        display: flex;
        flex-wrap: wrap; /* Cho phép các mục tự động xuống dòng */
        gap: 0.8rem; /* Khoảng cách giữa các mục */
        justify-content: space-between; /* Phân bố đều các mục */
        max-height: none; /* Xóa giới hạn chiều cao */
        overflow-x: hidden; /* Xóa cuộn ngang */
    }

    /* Mục dự báo */
    .forecast-item {
        background: var(--box-bg); /* Nền mục dự báo */
        padding: 0.8rem 1.2rem;
        border-radius: var(--border-radius); /* Bo góc */
        box-shadow: 0 4px 15px var(--shadow-color); /* Bóng */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        flex: 1 1 calc(33.333% - 0.8rem); /* 3 mục mỗi hàng trên màn hình lớn */
        min-width: 120px; /* Chiều rộng tối thiểu */
        height: 220px; /* Tăng chiều cao để chứa thêm khả năng mưa */
        text-align: center;
    }

    /* Cột thời gian */
    .forecast-item .time {
        font-size: clamp(0.9rem, 1.8vw, 1rem); /* Kích thước chữ thời gian */
        font-weight: 500;
        color: var(--text-dark);
        margin-bottom: 0.5rem; /* Khoảng cách dưới */
    }

    /* Dữ liệu thời tiết */
    .forecast-item .weather-data {
        display: flex;
        flex-direction: column; /* Hiển thị theo cột */
        gap: 0.3rem; /* Khoảng cách giữa các dòng */
        font-size: clamp(0.9rem, 1.8vw, 1rem); /* Kích thước chữ */
        align-items: center;
        text-align: center;
    }

    .forecast-item .temperature { color: var(--temperature-color); }
    .forecast-item .humidity { color: var(--humidity-color); }
    .forecast-item .precipitation { color: var(--precipitation-color); }
    .forecast-item .precipitation-probability { color: var(--precipitation-probability-color); } /* Màu khả năng mưa */
    .forecast-item .rain { color: var(--precipitation-color); }

    /* Keyframes cho hiệu ứng */
    @keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-1.5rem); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(1.5rem); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInRight {
        from { opacity: 0; transform: translateX(1.5rem); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* Tăng khả năng tiếp cận */
    @media (prefers-reduced-motion: reduce) {
        .box, .title, .calendar-container, .weather-container, .menu-container {
            animation: none; /* Tắt hiệu ứng */
            transition: none; /* Tắt chuyển đổi */
        }
    }

    /* Thiết kế responsive */
    @media (max-width: 1024px) {
        .body-container {
            flex-direction: column; /* Chuyển sang cột */
            align-items: center;
            margin-left: 0;
        }

        .box-container {
            width: 100%;
        }

        .right-side {
            width: 100%;
            max-width: 450px; /* Tăng chiều rộng tối đa cho tablet */
        }

        .menu-container {
            width: 100%;
            left: calc(-100%);
        }

        .menu-container:hover,
        .menu-trigger:hover ~ .menu-container {
            transform: translateX(100%); /* Hiển thị menu */
        }

        .menu-trigger {
            width: 15px; /* Giảm chiều rộng nút kích hoạt */
        }
    }

    @media (max-width: 768px) {
        .title {
            font-size: clamp(1.5rem, 4vw, 1.9rem); /* Giảm kích thước tiêu đề */
            padding: 1rem 1.5rem;
        }

        .top-row,
        .bottom-row {
            grid-template-columns: 1fr; /* 1 cột */
            gap: 1.5rem;
        }

        .box {
            max-width: 360px;
            margin: 0 auto;
        }

        .value {
            font-size: clamp(1.8rem, 3.5vw, 2.2rem); /* Giảm kích thước giá trị */
        }

        .forecast-item {
            flex: 1 1 calc(50% - 0.8rem); /* 2 mục mỗi hàng trên tablet */
            min-width: 100px;
            height: 200px; /* Giảm chiều cao */
        }

        .forecast-item .weather-data {
            font-size: clamp(0.8rem, 1.5vw, 0.9rem); /* Giảm kích thước chữ */
        }

        .forecast-item .time {
            font-size: clamp(0.8rem, 1.8vw, 0.9rem); /* Giảm kích thước thời gian */
        }
    }

    @media (max-width: 480px) {
        .title {
            font-size: clamp(1.3rem, 3.5vw, 1.6rem); /* Giảm kích thước tiêu đề */
        }

        body {
            padding: clamp(1rem, 3vw, 1.5rem); /* Giảm lề */
        }

        .calendar-day {
            font-size: clamp(2rem, 4vw, 2.8rem); /* Giảm kích thước ngày */
        }

        .forecast-item {
            flex: 1 1 100%; /* 1 mục mỗi hàng trên điện thoại */
            min-width: 100px;
            height: 180px; /* Giảm chiều cao */
        }

        .forecast-item .weather-data {
            font-size: clamp(0.8rem, 1.5vw, 0.9rem); /* Giảm kích thước chữ */
        }

        .forecast-item .time {
            min-width: 4rem;
        }
    }
        </style>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
        <!-- Font Awesome for icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    </head>
    <body>
        <!-- Menu Trigger and Sidebar -->
        <div class="menu-trigger"></div>
        <div class="menu-container">
            <div class="menu">
                <a href="index.html" class="menu-item"><i class="fas fa-home"></i> Trang chủ</a>
                <a href="dataanalist.html" class="menu-item"><i class="fas fa-chart-line"></i> Phân tích</a>
                <a href="giong.html" class="menu-item"><i class="fas fa-seedling"></i> Đề xuất giống</a>
                <a href="#" class="menu-item"><i class="fas fa-gamepad"></i> Điều khiển</a>
                <a href="#" class="menu-item"><i class="fas fa-comment"></i> Chat Box</a>
                <a href="#" class="menu-item"><i class="fas fa-cog"></i> Cài đặt</a>
                <a href="#" class="menu-item"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
            </div>
        </div>

        <div class="title">Hệ thống dự đoán sản lượng và giống phù hợp</div>
        <div class="body-container">
            <!-- Box Container (Left Side) with Background -->
            <div class="box-container">
                <div class="top-row">
                    <div class="box">
                        <h1>Nhiệt độ</h1>
                        <div class="data"><span class="value" id="temperature">--</span> °C</div>
                    </div>
                    <div class="box">
                        <h1>Độ ẩm</h1>
                        <div class="data"><span class="value" id="humidity">--</span> %</div>
                    </div>
                </div>
                <div class="bottom-row">
                    <div class="box">
                        <h1>Độ ẩm đất</h1>
                        <div class="data"><span class="value" id="soil_moisture">--</span> %</div>
                    </div>
                    <div class="box">
                        <h1>Nồng độ NH3+</h1>
                        <div class="data"><span class="value" id="nh3">--</span> ppm</div>
                    </div>
                    <div class="box">
                        <h1>Lượng mưa</h1>
                        <div class="data"><span class="value" id="precipitation">--</span> mm</div>
                    </div>
                </div>
            </div>

            <!-- Right Side: Calendar and Weather Forecast -->
            <div class="right-side">
                <!-- Calendar Container -->
                <div class="calendar-container">
                    <div class="calendar">
                        <div class="calendar-month-year" id="calendar-month-year"></div>
                        <div class="calendar-day" id="calendar-day"></div>
                        <div class="calendar-weekday" id="calendar-weekday"></div>
                        <div class="calendar-time" id="calendar-time"></div>
                    </div>
                </div>

                <!-- Weather Forecast Container Below Calendar -->
                <div class="weather-container">
                    <div style="margin-bottom: 1rem;">
                        <label for="forecast-hours" style="color: var(--text-dark); font-weight: 500;">Chọn khoảng thời gian dự báo: </label>
                        <select id="forecast-hours" onchange="updateForecastHours()">
                            <option value="3" selected>3 giờ</option>
                            <option value="6">6 giờ</option>
                            <option value="12">12 giờ</option>
                            <option value="24">24 giờ</option>
                            <option value="2days">2 ngày</option>
                            <option value="3days">3 ngày</option>
                            <option value="384">16 ngày</option>
                        </select>
                    </div>
                    <div class="weather-forecast" id="weather-forecast">
                        <!-- Forecast items will be added dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

        <script>
            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBNAFhMZtU3ubH5R6ZaYZ1rmt-4PLONfj4",
                authDomain: "myweb-34625.firebaseapp.com",
                databaseURL: "https://myweb-34625-default-rtdb.firebaseio.com",
                projectId: "myweb-34625",
                storageBucket: "myweb-34625.firebasestorage.app",
                messagingSenderId: "140146495176",
                appId: "1:140146495176:web:47027bcb3f5750a0b89ffd",
                measurementId: "G-7GNXDSY3F2"
            };

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            // Reference to Firebase Realtime Database
            const database = firebase.database();
            const dataRef = database.ref('data');

            // Listen for Firebase real-time updates
            dataRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    console.log('Firebase data received:', data);
                    document.getElementById('temperature').textContent = data.temperature ? data.temperature.toFixed(1) : 'N/A';
                    document.getElementById('humidity').textContent = data.humidity ? data.humidity.toFixed(1) : 'N/A';
                    document.getElementById('soil_moisture').textContent = data.soil_moisture ? data.soil_moisture.toFixed(1) : 'N/A';
                    document.getElementById('nh3').textContent = data.nh3 ? data.nh3.toFixed(1) : 'N/A';
                } else {
                    console.warn('No data available in Firebase at /data');
                    document.getElementById('temperature').textContent = 'N/A';
                    document.getElementById('humidity').textContent = 'N/A';
                    document.getElementById('soil_moisture').textContent = 'N/A';
                    document.getElementById('nh3').textContent = 'N/A';
                }
            }, (error) => {
                console.error('Error fetching Firebase data:', error.message);
                document.getElementById('temperature').textContent = 'Error';
                document.getElementById('humidity').textContent = 'Error';
                document.getElementById('soil_moisture').textContent = 'Error';
                document.getElementById('nh3').textContent = 'Error';
            });

            // Fetch weather data from Open-Meteo API
            async function fetchWeatherData(option) {
                const coordinates = {
                    latitude: 10.3678, // Suối Nghệ, Châu Đức, BRVT
                    longitude: 107.0989
                };
                const isLongTerm = option === '2days' || option === '3days' || option === '384';
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${coordinates.latitude}&longitude=${coordinates.longitude}&hourly=temperature_2m,relative_humidity_2m,precipitation,precipitation_probability&timezone=Asia/Ho_Chi_Minh${isLongTerm ? '&forecast_days=16' : ''}`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error ${response.status}`);
                    const data = await response.json();
                    if (data.hourly) {
                        // Update current precipitation
                        const latestPrecipitation = data.hourly.precipitation[0];
                        document.getElementById('precipitation').textContent = latestPrecipitation ? latestPrecipitation.toFixed(1) : '0.0';
                        console.log('Current precipitation:', latestPrecipitation);

                        // Send precipitation to Firebase
                        try {
                            const precipitationValue = typeof latestPrecipitation === 'number' && !isNaN(latestPrecipitation) ? latestPrecipitation : 0;
                            await database.ref('data/precipitation').set(precipitationValue);
                            console.log('Precipitation sent to Firebase as number:', precipitationValue);
                        } catch (error) {
                            console.error('Error sending precipitation to Firebase:', error.message);
                        }

                        // Update weather forecast based on selected option
                        const forecastContainer = document.getElementById('weather-forecast');
                        forecastContainer.innerHTML = ''; // Clear previous forecast

                        const hours = option === '2days' ? 48 : option === '3days' ? 72 : option === '384' ? 384 : parseInt(option);
                        const times = data.hourly.time;
                        const temperatures = data.hourly.temperature_2m;
                        const humidities = data.hourly.relative_humidity_2m;
                        const precipitations = data.hourly.precipitation;
                        const precipitationProbabilities = data.hourly.precipitation_probability;

                        // Get current time in Vietnam timezone
                        const now = new Date();
                        const currentTime = now.getTime();

                        if (hours <= 12) {
                            // Detailed hourly forecast for 3, 6, 12 hours
                            let count = 0;
                            for (let index = 0; index < times.length && count < hours; index++) {
                                const forecastTime = new Date(times[index]).getTime();
                                if (forecastTime > currentTime) {
                                    const date = new Date(times[index]);
                                    const hours = date.getHours();
                                    const period = hours >= 12 ? 'PM' : 'AM';
                                    const displayHour = hours % 12 || 12;

                                    let rainIcon = precipitations[index] > 10 ? '🌧️'
                                        : precipitations[index] > 2 ? '🌦️'
                                        : precipitations[index] > 0 ? '💧'
                                        : temperatures[index] <= 25 ? '🌫️' : '☁️';

                                    const forecastItem = `
                                        <div class="forecast-item">
                                            <span class="time">${displayHour} ${period}</span>
                                            <div class="weather-data">
                                                <span class="temperature">${temperatures[index].toFixed(1)}°C</span>
                                                <span class="humidity">${humidities[index]}%</span>
                                                <span class="precipitation">${precipitations[index].toFixed(1)}mm</span>
                                                <span class="precipitation-probability">${precipitationProbabilities[index]}%</span>
                                                <span class="rain">${rainIcon}</span>
                                            </div>
                                        </div>
                                    `;
                                    forecastContainer.innerHTML += forecastItem;
                                    count++;
                                }
                            }
                            if (count === 0) {
                                forecastContainer.innerHTML = '<div>Không có dự báo cho khung giờ này</div>';
                            }
                        } else if (hours === 24) {
                            // Summary forecast for 24 hours
                            let futureTemps = [];
                            let futureHums = [];
                            let futurePrecs = [];
                            let futurePrecProbs = [];
                            for (let index = 0; index < times.length && futureTemps.length < 24; index++) {
                                const forecastTime = new Date(times[index]).getTime();
                                if (forecastTime > currentTime) {
                                    futureTemps.push(temperatures[index]);
                                    futureHums.push(humidities[index]);
                                    futurePrecs.push(precipitations[index]);
                                    futurePrecProbs.push(precipitationProbabilities[index]);
                                }
                            }

                            if (futureTemps.length === 0) {
                                forecastContainer.innerHTML = '<div>Không có dự báo cho khung giờ này</div>';
                                return;
                            }

                            const minTemperature = Math.min(...futureTemps);
                            const maxTemperature = Math.max(...futureTemps);
                            const minHumidity = Math.min(...futureHums);
                            const maxHumidity = Math.max(...futureHums);
                            const totalPrecipitation = futurePrecs.reduce((sum, prec) => sum + prec, 0);
                            const maxPrecipitationProbability = Math.max(...futurePrecProbs);

                            let rainIcon = totalPrecipitation > 10 ? '🌧️'
                                : totalPrecipitation > 2 ? '🌦️'
                                : totalPrecipitation > 0 ? '💧'
                                : minTemperature <= 25 ? '🌫️' : '☁️';

                            const forecastItem = `
                                <div class="forecast-item">
                                    <span class="time">24 giờ tới</span>
                                    <div class="weather-data">
                                        <span class="temperature">${minTemperature.toFixed(1)} -- ${maxTemperature.toFixed(1)}°C</span>
                                        <span class="humidity">${minHumidity} -- ${maxHumidity}%</span>
                                        <span class="precipitation">${totalPrecipitation.toFixed(1)}mm</span>
                                        <span class="precipitation-probability">${maxPrecipitationProbability}%</span>
                                        <span class="rain">${rainIcon}</span>
                                    </div>
                                </div>
                            `;
                            forecastContainer.innerHTML = forecastItem;
                        } else if (option === '2days' || option === '3days') {
                            // Daily forecast for 2 or 3 days
                            const numDays = option === '2days' ? 2 : 3;
                            let currentDay = null;
                            let dayTemps = [];
                            let dayHums = [];
                            let dayPrecs = [];
                            let dayPrecProbs = [];
                            let daysAdded = 0;

                            for (let index = 0; index < times.length && daysAdded < numDays; index++) {
                                const forecastTime = new Date(times[index]);
                                const forecastTimeMs = forecastTime.getTime();
                                if (forecastTimeMs <= currentTime) continue;

                                const forecastDay = forecastTime.toLocaleString('vi-VN', { day: 'numeric', month: 'numeric' });

                                if (currentDay !== forecastDay) {
                                    if (dayTemps.length > 0) {
                                        const minTemp = Math.min(...dayTemps);
                                        const maxTemp = Math.max(...dayTemps);
                                        const minHum = Math.min(...dayHums);
                                        const maxHum = Math.max(...dayHums);
                                        const totalPrec = dayPrecs.reduce((sum, prec) => sum + prec, 0);
                                        const maxPrecProb = Math.max(...dayPrecProbs);

                                        let rainIcon = totalPrec > 10 ? '🌧️'
                                            : totalPrec > 2 ? '🌦️'
                                            : totalPrec > 0 ? '💧'
                                            : minTemp <= 25 ? '🌫️' : '☁️';

                                        const forecastItem = `
                                            <div class="forecast-item">
                                                <span class="time">${currentDay}</span>
                                                <div class="weather-data">
                                                    <span class="temperature">${minTemp.toFixed(1)} -- ${maxTemp.toFixed(1)}°C</span>
                                                    <span class="humidity">${minHum} -- ${maxHum}%</span>
                                                    <span class="precipitation">${totalPrec.toFixed(1)}mm</span>
                                                    <span class="precipitation-probability">${maxPrecProb}%</span>
                                                    <span class="rain">${rainIcon}</span>
                                                </div>
                                            </div>
                                        `;
                                        forecastContainer.innerHTML += forecastItem;
                                        daysAdded++;
                                    }
                                    currentDay = forecastDay;
                                    dayTemps = [];
                                    dayHums = [];
                                    dayPrecs = [];
                                    dayPrecProbs = [];
                                }
                                dayTemps.push(temperatures[index]);
                                dayHums.push(humidities[index]);
                                dayPrecs.push(precipitations[index]);
                                dayPrecProbs.push(precipitationProbabilities[index]);
                            }

                            if (dayTemps.length > 0 && daysAdded < numDays) {
                                const minTemp = Math.min(...dayTemps);
                                const maxTemp = Math.max(...dayTemps);
                                const minHum = Math.min(...dayHums);
                                const maxHum = Math.max(...dayHums);
                                const totalPrec = dayPrecs.reduce((sum, prec) => sum + prec, 0);
                                const maxPrecProb = Math.max(...dayPrecProbs);

                                let rainIcon = totalPrec > 10 ? '🌧️'
                                    : totalPrec > 2 ? '🌦️'
                                    : totalPrec > 0 ? '💧'
                                    : minTemp <= 25 ? '🌫️' : '☁️';

                                const forecastItem = `
                                    <div class="forecast-item">
                                        <span class="time">${currentDay}</span>
                                        <div class="weather-data">
                                            <span class="temperature">${minTemp.toFixed(1)} -- ${maxTemp.toFixed(1)}°C</span>
                                            <span class="humidity">${minHum} -- ${maxHum}%</span>
                                            <span class="precipitation">${totalPrec.toFixed(1)}mm</span>
                                            <span class="precipitation-probability">${maxPrecProb}%</span>
                                            <span class="rain">${rainIcon}</span>
                                        </div>
                                    </div>
                                `;
                                forecastContainer.innerHTML += forecastItem;
                            }

                            if (forecastContainer.innerHTML === '') {
                                forecastContainer.innerHTML = '<div>Không có dự báo cho khung giờ này</div>';
                            }
                        } else if (option === '384') {
                            // Summary daily forecast for 16 days
                            let currentDay = null;
                            let dayTemps = [];
                            let dayHums = [];
                            let dayPrecs = [];
                            let dayPrecProbs = [];
                            let daysAdded = 0;

                            for (let index = 0; index < times.length && daysAdded < 16; index++) {
                                const forecastTime = new Date(times[index]);
                                const forecastTimeMs = forecastTime.getTime();
                                if (forecastTimeMs <= currentTime) continue;

                                const forecastDay = forecastTime.toLocaleString('vi-VN', { day: 'numeric', month: 'numeric' });

                                if (currentDay !== forecastDay) {
                                    if (dayTemps.length > 0) {
                                        const minTemp = Math.min(...dayTemps);
                                        const maxTemp = Math.max(...dayTemps);
                                        const minHum = Math.min(...dayHums);
                                        const maxHum = Math.max(...dayHums);
                                        const totalPrec = dayPrecs.reduce((sum, prec) => sum + prec, 0);
                                        const maxPrecProb = Math.max(...dayPrecProbs);

                                        let rainIcon = totalPrec > 10 ? '🌧️'
                                            : totalPrec > 2 ? '🌦️'
                                            : totalPrec > 0 ? '💧'
                                            : minTemp <= 25 ? '🌫️' : '☁️';

                                        const forecastItem = `
                                            <div class="forecast-item">
                                                <span class="time">${currentDay}</span>
                                                <div class="weather-data">
                                                    <span class="temperature">${minTemp.toFixed(1)} -- ${maxTemp.toFixed(1)}°C</span>
                                                    <span class="humidity">${minHum} -- ${maxHum}%</span>
                                                    <span class="precipitation">${totalPrec.toFixed(1)}mm</span>
                                                    <span class="precipitation-probability">${maxPrecProb}%</span>
                                                    <span class="rain">${rainIcon}</span>
                                                </div>
                                            </div>
                                        `;
                                        forecastContainer.innerHTML += forecastItem;
                                        daysAdded++;
                                    }
                                    currentDay = forecastDay;
                                    dayTemps = [];
                                    dayHums = [];
                                    dayPrecs = [];
                                    dayPrecProbs = [];
                                }
                                dayTemps.push(temperatures[index]);
                                dayHums.push(humidities[index]);
                                dayPrecs.push(precipitations[index]);
                                dayPrecProbs.push(precipitationProbabilities[index]);
                            }

                            if (dayTemps.length > 0 && daysAdded < 16) {
                                const minTemp = Math.min(...dayTemps);
                                const maxTemp = Math.max(...dayTemps);
                                const minHum = Math.min(...dayHums);
                                const maxHum = Math.max(...dayHums);
                                const totalPrec = dayPrecs.reduce((sum, prec) => sum + prec, 0);
                                const maxPrecProb = Math.max(...dayPrecProbs);

                                let rainIcon = totalPrec > 10 ? '🌧️'
                                    : totalPrecipitation > 2 ? '🌦️'
                                    : totalPrecipitation > 0 ? '💧'
                                    : minTemp <= 25 ? '🌫️' : '☁️';

                                const forecastItem = `
                                    <div class="forecast-item">
                                        <span class="time">${currentDay}</span>
                                        <div class="weather-data">
                                            <span class="temperature">${minTemp.toFixed(1)} -- ${maxTemp.toFixed(1)}°C</span>
                                            <span class="humidity">${minHum} -- ${maxHum}%</span>
                                            <span class="precipitation">${totalPrec.toFixed(1)}mm</span>
                                            <span class="precipitation-probability">${maxPrecProb}%</span>
                                            <span class="rain">${rainIcon}</span>
                                        </div>
                                    </div>
                                `;
                                forecastContainer.innerHTML += forecastItem;
                            }

                            if (forecastContainer.innerHTML === '') {
                                forecastContainer.innerHTML = '<div>Không có dự báo cho khung giờ này</div>';
                            }
                        }
                    } else {
                        console.warn('No weather data available from Open-Meteo');
                        document.getElementById('precipitation').textContent = 'N/A';
                        document.getElementById('weather-forecast').innerHTML = '<div>Không có dự báo thời tiết</div>';
                    }
                } catch (error) {
                    console.error('Error fetching weather data:', error.message);
                    document.getElementById('precipitation').textContent = 'Lỗi';
                    document.getElementById('weather-forecast').innerHTML = '<div>Lỗi tải dự báo</div>';
                }
            }

            // Function to update forecast based on selected option
            function updateForecastHours() {
                const option = document.getElementById('forecast-hours').value;
                fetchWeatherData(option);
            }

            // Initial fetch with default 3 hours
            fetchWeatherData('3');
            setInterval(() => fetchWeatherData(document.getElementById('forecast-hours').value), 10 * 60 * 1000);

            // Update Calendar with Current Date and Time
            function updateCalendar() {
                const now = new Date();
                const options = { timeZone: 'Asia/Ho_Chi_Minh' };

                const day = now.getDate();
                const monthYear = now.toLocaleString('vi-VN', { month: 'long', year: 'numeric', ...options });
                const weekday = now.toLocaleString('vi-VN', { weekday: 'long', ...options });
                const time = now.toLocaleString('vi-VN', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true, ...options });

                document.getElementById('calendar-day').textContent = day;
                document.getElementById('calendar-month-year').textContent = monthYear;
                document.getElementById('calendar-weekday').textContent = weekday;
                document.getElementById('calendar-time').textContent = time;
            }

            // Initial update and refresh every second
            updateCalendar();
            setInterval(updateCalendar, 1000);
        </script>
    </body>
    </html>